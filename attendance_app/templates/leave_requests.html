{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Leave Requests</h2>

  <form method="GET" class="row g-3 mb-3">
    <div class="col-md-3">
      <input type="date" name="start_date" class="form-control" placeholder="Start Date" value="{{ start_date }}">
    </div>
    <div class="col-md-3">
      <input type="date" name="end_date" class="form-control" placeholder="End Date" value="{{ end_date }}">
    </div>

    {% if current_user.is_admin %}
    <div class="col-md-3">
      <select name="user_id" class="form-select">
        <option value="">All Employees</option>
        {% for user in users %}
          <option value="{{ user.id }}" {% if user_id == user.id|string %}selected{% endif %}>{{ user.name }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}

    <div class="col-md-3">
      <button type="submit" class="btn btn-primary">Filter</button>
      <a href="{{ url_for('leave_requests') }}" class="btn btn-secondary">Clear</a>
    </div>
  </form>

  <div class="mb-3">
    <a href="{{ url_for('leave_requests_export', file_type='excel', start_date=start_date, end_date=end_date, user_id=user_id) }}" class="btn btn-success me-2">Export Excel</a>
    <a href="{{ url_for('leave_requests_export', file_type='pdf', start_date=start_date, end_date=end_date, user_id=user_id) }}" class="btn btn-danger">Export PDF</a>
  </div>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        {% if current_user.is_admin %}
        <th>Employee</th>
        {% endif %}
        <th>Start Date</th>
        <th>End Date</th>
        <th>Reason</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for lr in leave_requests %}
      <tr>
        {% if current_user.is_admin %}
        <td>{{ lr.user.name }}</td>
        {% endif %}
        <td>{{ lr.start_date.strftime('%Y-%m-%d') }}</td>
        <td>{{ lr.end_date.strftime('%Y-%m-%d') }}</td>
        <td>{{ lr.reason }}</td>
        <td>{{ lr.status }}</td>
      </tr>
      {% else %}
      <tr><td colspan="5" class="text-center">No leave requests found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
